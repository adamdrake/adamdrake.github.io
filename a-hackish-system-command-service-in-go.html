<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer">
<meta name=description content="Adam Drake is an advisor to scale-up tech companies. He writes about ML/AI/crypto/data, leadership, and building tech teams.">
<title>
A Hackish System Command Service in Go - Adam Drake
</title>
<link rel="shortcut icon" href=/static/favicon.ico>
<link rel=stylesheet href=https://adamdrake.com/sass/style.min.4b0d3fd52024283b14d542e540f013de2976b7a9ca4436a50d9555c6a678c3be.css integrity="sha256-Sw0/1SAkKDsU1ULlQPAT3il2t6nKRDalDZVVxqZ4w74=" crossorigin=anonymous media=screen>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://adamdrake.com/static/images/twitter-card.jpg">
<meta name=twitter:title content="A Hackish System Command Service in Go">
<meta name=twitter:description content="When building data products, often the end result is either a recurring report or an API which allows for an interface with other services. In these cases, the product might be run by a cron job, or even manually, depending on the situation. When the product is part of (more frequently, at the end of) a larger data processing pipeline, this can become inefficient or problematic since steps earlier in the pipeline can cause the product to supply incorrect information or fail altogether.">
<meta property="og:title" content="A Hackish System Command Service in Go">
<meta property="og:description" content="When building data products, often the end result is either a recurring report or an API which allows for an interface with other services. In these cases, the product might be run by a cron job, or even manually, depending on the situation. When the product is part of (more frequently, at the end of) a larger data processing pipeline, this can become inefficient or problematic since steps earlier in the pipeline can cause the product to supply incorrect information or fail altogether.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://adamdrake.com/a-hackish-system-command-service-in-go.html"><meta property="og:image" content="https://adamdrake.com/static/images/twitter-card.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-09-27T00:00:00+00:00">
<meta property="article:modified_time" content="2015-09-27T00:00:00+00:00">
</head>
<body>
<div class=title-box>
<div class=title-left>
<h1 class=name><a href=/>Adam Drake</a></h1>
</div>
<div class=title-right>
<div class=social-icons>
<a href=https://github.com/adamdrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC5UlEQVR4nO2a0XXiMBBFKYESKIEOlg5CB3EHmw5wB9DBbgebDnAHTgemA9PB3Q8J1mtkaSSPjTnRPYePHIzem/FoJFtZrTKZTCaTyWQmBFgD78ABOAMNjzT2u4O9dv1s36OwQf8EakewUmo7xuskA9gAR6AdEXif1o65eXZ8XjDlqxm4KxGHZ8f5ALBlXKnHUrOUagAKpr3rQ7TAfgnBP5viOwd/Y94ksKzgb8wzHTAN7xlzPkTLHI0Rf7ffdZJUAleFwK52rK0de+e5tp46+NJn1HH92vGbK1DZz6f93P7uJ6zEsQsMJKycKvgN/tKvAr/dIyhRybU2WUNMMxWAUyDzlbrosBdfAvSrAFPKocZXqYr6/YQS0KL5AAV8BAQBWjXBsB/JKlRoCkr2+Q9NcCqQrS46KwKm/CXsVARlnnxLYZfx0wDZru9TIa5YX6E+ABq7Q8LdH2a8+x1fe4GvUkMolOnZ5r7DW6gXVBoizeQi6d5CN6fREAlRjQ8l2VuwD2iI5AR89wRcJhdJ9xbioiEiWW83o4XifW0EvioNIUkCitFC8b4kG7RKQ0iyETqPDyna11ng66QhJNlxwTKfBVS2wtKHoZoZDjGtH+kplI4f4GsJSYgM/ktTOOYcoMa+wdUEU/ZNhI9CU3zN44NHZRPze8DAH+BNQfvNjhWD/gMaj6vB/YQWcw7g2zCdMUfnwcrA3Okjsi4/xPju7zDmqoKWfwcWW8f3XS4I+oPVCe4+PVwlOqlJcL0cvb+Bxd8rPkbqSBHrJIF7Z1gKzIsbI/J1vk81Rcx9c65S/+89PKaM9zYZOxJKMiH4a0ySRzFwh34pa8QyT/Adg675flQcP4ZCSzfWpCsJDWbJ+9H5vCeMvezgO0Z3CE5qEsYNMd+cD4FpjN73Bglj+qgWE3wXTNd3VkPCWEN3fdp1fiyYJfDUT0TCOP3AT7zS/wyvVvcmWZGwN7cB3x64XivwTCaTyWQymVfgL42yxWFGEKJcAAAAAElFTkSuQmCC width=64 height=64>
</a>
<a href=https://twitter.com/aadrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACQ0lEQVR4nO2a0XWjMBBFXQIluIR0EDpIOjAdLB1kO0g6sDvIdgAd2B3gDkwHNx8jEkIMNmTGkvfMPUc//hjmPTTSIHm1chzHcRzHcRzHSQggAx6BlzA2wEPsvMwBcqBinCYYkl2I8WyRXKEe9Ct2BmwnhJ8z4mEQ46ln3lo7wTwELlQDrz7F72eI7zgBr8D74Pc37RxXwK73gEI59naB+DEOTJTHb5IcvqFCKW7+U8PvxIex0cqxS/QcW4W4jZL4rhyqvhka2rtEx9izcHsC1krih7RLc5pK9jDxwBMXtqaRmKWB+KO6+JDsvyse3gCbGTH/Kou3WQBDssWMRBrgz6VkDAywER+SzZDamkuFmPFjWqJsgJn4XsIaNVsh+/4L0y3vbMwNCCZcsxZEwVr4K7JtZXzvClOhtTagY49M3VMcnaPU1gZM9QEpsLM24C22wgsU1gZYta1a2J8Wke4sOJqLDwZkpLkW6B+A3JkJtz0sRUxIpRwONxU/MGKNNEXHiAYUMYQ/I81QN2I1Rcebiw8GrFn2ZaiN/tn/DBO0v+XnUkcT3zOhjiS+RfviY6EBGXE+j4vY2r+BHJTcak3YxdZ7FmQ2lMiMsDIj3p4/B+S2p9EWj+WhpwbILBheVGpQJy0e6Qu2BsIh4Zp/RM4Jl1xrX0NLzEanJzRH+v0K/boeI70pj3R+1ltdDeSxtU6CXJFpdoAtMsPu6w9QyMJXsuxz+ICcJ8SvcS2QLTAPo0RKphtl+P2+3rLjOI7jOI7jOP8tH5ahgbeYuZE9AAAAAElFTkSuQmCC width=64 height=64>
</a>
<a href=https://linkedin.com/in/aadrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAzElEQVRIie2WWxGDMBBFVwISkIAEnBQJOCoOKqE4AAeNg+Lg9AOY2VmSTls29If7eTPJmbubl8gioAEG/DQAF9ECOkeA1VUnya1GgPEA0CARs2dO2QLBi2RBAShU78pcoF6MgCkH6AlUClJ7QGKgFXYD7l6QFOhbBeYN9Hb3bkCRHqX8CaiNV6aAe0CV9Ra/IHIsfgapRYuIv7lt9iTSi7VmbHP+9oB0eR6peR6gj+adoBP0X9ART/l43OdkiZnzu9XZmjb4lnFkTSIiLyov4WUSpGLDAAAAAElFTkSuQmCC width=64 height=64>
</a>
</div>
<button class="subscribe subscribe-btn">
<a href=https://www.digitalmaneuver.com/#/portal>Subscribe to my newsletter</a>
</button>
</div>
</div>
<div class="nav-box row">
<div class=nav-left-menu>
<ul>
<li><a href=/>Latest</a> | </li>
<li><a href=/about.html>About</a> | </li>
<li><a href=/cases.html>Case Studies</a> | </li>
<li><a href=/contact.html>Contact</a> | </li>
<li><a href=/press.html>Press</a></li>
</ul>
</div>
</div>
<section class=section>
<div class=container>
<a href=https://applybyapi.com><button class=btn>Struggling to hire developers? Check out ApplyByAPI!</button></a>
<h1 class=page-title>A Hackish System Command Service in Go</h1>
<h2 class=content-date>September 27, 2015</h2>
<div class=share-links>
Share this:
<a class=twitter-share-button href="https://twitter.com/intent/tweet?text=Read%20A%20Hackish%20System%20Command%20Service%20in%20Go%20https%3a%2f%2fadamdrake.com%2fa-hackish-system-command-service-in-go.html" onclick="return window.open(this.href,'twitter-share','width=550,height=235'),!1">
twitter
</a> //
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fadamdrake.com%2fa-hackish-system-command-service-in-go.html" onclick="return window.open(this.href,'facebook-share','width=580,height=296'),!1">
facebook
</a> //
<a class=icon-linkedin href="https://www.linkedin.com/shareArticle?mini=true&url=https://adamdrake.com&title=A%20Hackish%20System%20Command%20Service%20in%20Go&source=Adam%20Drake" onclick="return window.open(this.href,'linkedin-share','width=980,height=980'),!1">
linkedin
</a>
</div>
<div class=content>
<p>When building data products, often the end result is either a recurring report or an API which allows for an interface with other services. In these cases, the product might be run by a cron job, or even manually, depending on the situation. When the product is part of (more frequently, at the end of) a larger data processing pipeline, this can become inefficient or problematic since steps earlier in the pipeline can cause the product to supply incorrect information or fail altogether.</p>
<p>To get around this problem it is often desirable to have previous steps in the data processing pipeline directly trigger the data product to run. This ensures that earlier steps of the pipeline have completed successfully and also eliminates the need for buffer time before the cron job starts. A way this coupling is often accomplished is via an HTTP endpoint which can be hit by some calling entity, thus triggering the processing job to start.</p>
<p>When the cron job is already running, building such an HTTP endpoint can be very straightforward since you need only run a local command on the system in question (responding with HTTP code 200, OK) and then while the command is running any subsequent requests can provide an HTTP 503 (Service Unavailable) response.</p>
<p>With that in mind, here is a small example in Go which accomplishes the task. It will listen on some port for requests to a <code>/start</code> endpoint. When that URL is accessed the command will be run in a separate goroutine, and any requests which come in while the command is running will receive a 503 response. After the command completes and errors are handled the system is available and can be restarted again.</p>
<p>This is just a very rough outline and has some nasty things (e.g., global variables, security problems) but it provides the necessary endpoint and does what is needed with minimal effort.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#069;font-weight:700>package</span> main

<span style=color:#069;font-weight:700>import</span> (
	<span style=color:#c30>&#34;net/http&#34;</span>
	<span style=color:#c30>&#34;os/exec&#34;</span>
)

<span style=color:#069;font-weight:700>const</span> (
	command = <span style=color:#c30>&#34;commandTorun&#34;</span>
	args    = <span style=color:#c30>&#34;argumentsForTheCommand&#34;</span>
	port    = <span style=color:#c30>&#34;:8080&#34;</span>
)

<span style=color:#069;font-weight:700>var</span> jobRunning = <span style=color:#069;font-weight:700>false</span>

<span style=color:#069;font-weight:700>func</span> <span style=color:#c0f>runJob</span>() {
	jobRunning = <span style=color:#069;font-weight:700>true</span>
	err <span style=color:#555>:=</span> exec.<span style=color:#c0f>Command</span>(command, args).<span style=color:#c0f>Run</span>()
	<span style=color:#069;font-weight:700>if</span> err <span style=color:#555>!=</span> <span style=color:#069;font-weight:700>nil</span> {
		<span style=color:#09f;font-style:italic>// Error was returned from system command.  Do something.
</span><span style=color:#09f;font-style:italic></span>	}
	jobRunning = <span style=color:#069;font-weight:700>false</span>
}

<span style=color:#069;font-weight:700>func</span> <span style=color:#c0f>jobStartEndpoint</span>(w http.ResponseWriter, r <span style=color:#555>*</span>http.Request) {
	<span style=color:#069;font-weight:700>if</span> jobRunning {
		w.<span style=color:#c0f>WriteHeader</span>(<span style=color:#f60>503</span>)
	} <span style=color:#069;font-weight:700>else</span> {
		<span style=color:#069;font-weight:700>go</span> <span style=color:#c0f>runJob</span>()
		w.<span style=color:#c0f>WriteHeader</span>(<span style=color:#f60>200</span>)

	}
}

<span style=color:#069;font-weight:700>func</span> <span style=color:#c0f>main</span>() {
	http.<span style=color:#c0f>HandleFunc</span>(<span style=color:#c30>&#34;/start&#34;</span>, jobStartEndpoint)
	http.<span style=color:#c0f>ListenAndServe</span>(port, <span style=color:#069;font-weight:700>nil</span>)
}
</code></pre></div>
</div>
</div>
</section>
<div class="nav-box row">
<div class=nav-left-menu>
<ul>
<li><a href=/>Latest</a> | </li>
<li><a href=/about.html>About</a> | </li>
<li><a href=/cases.html>Case Studies</a> | </li>
<li><a href=/contact.html>Contact</a> | </li>
<li><a href=/press.html>Press</a></li>
</ul>
</div>
</div>
<div class="footer-box row">
<div class="footer-left col-md-6 col-xs-12">
<div class="footer-bio content">
<p><strong>Adam Drake</strong> leads technical business transformations in global and multi-cultural environments. He has a passion for helping companies become more productive by improving internal leadership capabilities, and accelerating product development through technology and data architecture guidance. Adam has served as a White House Presidential Innovation Fellow and is an IEEE Senior Member.</p>
</div>
</div>
<div class=footer-right>
<div class=social-icons>
<a href=https://github.com/adamdrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC5UlEQVR4nO2a0XXiMBBFKYESKIEOlg5CB3EHmw5wB9DBbgebDnAHTgemA9PB3Q8J1mtkaSSPjTnRPYePHIzem/FoJFtZrTKZTCaTyWQmBFgD78ABOAMNjzT2u4O9dv1s36OwQf8EakewUmo7xuskA9gAR6AdEXif1o65eXZ8XjDlqxm4KxGHZ8f5ALBlXKnHUrOUagAKpr3rQ7TAfgnBP5viOwd/Y94ksKzgb8wzHTAN7xlzPkTLHI0Rf7ffdZJUAleFwK52rK0de+e5tp46+NJn1HH92vGbK1DZz6f93P7uJ6zEsQsMJKycKvgN/tKvAr/dIyhRybU2WUNMMxWAUyDzlbrosBdfAvSrAFPKocZXqYr6/YQS0KL5AAV8BAQBWjXBsB/JKlRoCkr2+Q9NcCqQrS46KwKm/CXsVARlnnxLYZfx0wDZru9TIa5YX6E+ABq7Q8LdH2a8+x1fe4GvUkMolOnZ5r7DW6gXVBoizeQi6d5CN6fREAlRjQ8l2VuwD2iI5AR89wRcJhdJ9xbioiEiWW83o4XifW0EvioNIUkCitFC8b4kG7RKQ0iyETqPDyna11ng66QhJNlxwTKfBVS2wtKHoZoZDjGtH+kplI4f4GsJSYgM/ktTOOYcoMa+wdUEU/ZNhI9CU3zN44NHZRPze8DAH+BNQfvNjhWD/gMaj6vB/YQWcw7g2zCdMUfnwcrA3Okjsi4/xPju7zDmqoKWfwcWW8f3XS4I+oPVCe4+PVwlOqlJcL0cvb+Bxd8rPkbqSBHrJIF7Z1gKzIsbI/J1vk81Rcx9c65S/+89PKaM9zYZOxJKMiH4a0ySRzFwh34pa8QyT/Adg675flQcP4ZCSzfWpCsJDWbJ+9H5vCeMvezgO0Z3CE5qEsYNMd+cD4FpjN73Bglj+qgWE3wXTNd3VkPCWEN3fdp1fiyYJfDUT0TCOP3AT7zS/wyvVvcmWZGwN7cB3x64XivwTCaTyWQymVfgL42yxWFGEKJcAAAAAElFTkSuQmCC width=64 height=64>
</a>
<a href=https://twitter.com/aadrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACQ0lEQVR4nO2a0XWjMBBFXQIluIR0EDpIOjAdLB1kO0g6sDvIdgAd2B3gDkwHNx8jEkIMNmTGkvfMPUc//hjmPTTSIHm1chzHcRzHcRzHSQggAx6BlzA2wEPsvMwBcqBinCYYkl2I8WyRXKEe9Ct2BmwnhJ8z4mEQ46ln3lo7wTwELlQDrz7F72eI7zgBr8D74Pc37RxXwK73gEI59naB+DEOTJTHb5IcvqFCKW7+U8PvxIex0cqxS/QcW4W4jZL4rhyqvhka2rtEx9izcHsC1krih7RLc5pK9jDxwBMXtqaRmKWB+KO6+JDsvyse3gCbGTH/Kou3WQBDssWMRBrgz6VkDAywER+SzZDamkuFmPFjWqJsgJn4XsIaNVsh+/4L0y3vbMwNCCZcsxZEwVr4K7JtZXzvClOhtTagY49M3VMcnaPU1gZM9QEpsLM24C22wgsU1gZYta1a2J8Wke4sOJqLDwZkpLkW6B+A3JkJtz0sRUxIpRwONxU/MGKNNEXHiAYUMYQ/I81QN2I1Rcebiw8GrFn2ZaiN/tn/DBO0v+XnUkcT3zOhjiS+RfviY6EBGXE+j4vY2r+BHJTcak3YxdZ7FmQ2lMiMsDIj3p4/B+S2p9EWj+WhpwbILBheVGpQJy0e6Qu2BsIh4Zp/RM4Jl1xrX0NLzEanJzRH+v0K/boeI70pj3R+1ltdDeSxtU6CXJFpdoAtMsPu6w9QyMJXsuxz+ICcJ8SvcS2QLTAPo0RKphtl+P2+3rLjOI7jOI7jOP8tH5ahgbeYuZE9AAAAAElFTkSuQmCC width=64 height=64>
</a>
<a href=https://linkedin.com/in/aadrake>
<img class=icon src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAzElEQVRIie2WWxGDMBBFVwISkIAEnBQJOCoOKqE4AAeNg+Lg9AOY2VmSTls29If7eTPJmbubl8gioAEG/DQAF9ECOkeA1VUnya1GgPEA0CARs2dO2QLBi2RBAShU78pcoF6MgCkH6AlUClJ7QGKgFXYD7l6QFOhbBeYN9Hb3bkCRHqX8CaiNV6aAe0CV9Ra/IHIsfgapRYuIv7lt9iTSi7VmbHP+9oB0eR6peR6gj+adoBP0X9ART/l43OdkiZnzu9XZmjb4lnFkTSIiLyov4WUSpGLDAAAAAElFTkSuQmCC width=64 height=64>
</a>
</div>
<button class="subscribe subscribe-btn">
<a href=https://www.digitalmaneuver.com/#/portal>Subscribe to my newsletter</a>
</button>
</div>
</div>
<div class="container has-text-centered footer-copyright">
</div>
</body>